{%  extends "base.html.twig" %}

{% block title %}
	{{ currentCategory.getTitleFr() }} - Les Soeurs Théière
{% endblock %}

{% block body %}
	<div class="container">
    	{% if ancestors|length %}
        	<nav aria-label="breadcrumb" class="ariane col">
        		<ol class="breadcrumb">
        			{% for category in ancestors %}
        				<li class="breadcrumb-item{% if loop.index == loop.length %} active{% endif %}"{% if loop.index == loop.length %} aria-current="page"{% endif %}>
        					{% if loop.last == false %}
        						<a href="{{ path("products_category", {"slug": category.getId()}) }}" title="{{ category.getTitleFr() }}">{{ category.getTitleFr()|upper }}</a>
        					{% else %}
        						{{ category.getTitleFr()|upper }}
        					{% endif %}
        				</li>
        			{% endfor %}
        		</ol>
        	</nav>
        	
        	<!-- Barre d'outils : tri, affichage, ... -->
        {% endif %}
    </div>
    
    <section class="category-products">
    	<header class="header">
    		<h1>{{ currentCategory.getTitleFr()|upper }}</h1>
    	</header>
    	
    	<!--  Boucle sur les produits de la catégorie courante -->
        {% if products|length %}
        	<div class="row">
            	{% for product in products if product.getIsEnabled() %}
            		<div class=" col-xl-3 col-lg-4 col-md-4 col-sm-12 col-xs-12">
                		<article class="card" id="{{ product.getSlug() }}" data-id="{{ product.getId() }}">
                			<header class="card-header">
                				<h2 class="card-title">{{ product.getTitleFr() }}</h2>
                				{% if product.getSmallestPrice()["multi"] %}
                					<span class="badge badge-secondary">A partir de {{ product.getSmallestPrice()["ttc"]|number_format(2, ',') }} &euro;</span>
                				{% else %}
                					<span class="badge badge-secondary">{{ product.getSmallestPrice()["ttc"]|number_format(2, ',') }} &euro;</span>
                				{% endif %}
                			</header>
                			<figure>
                				<img class="card-img-top" src="{{ product.getMainImage()["src"] }}" alt="{{ product.getMainImage()["alt"] }}">
                			</figure>
                			
                			<div class="card-body">
                				<p class="card-text">
                					{{ product.getDescriptionFr() }}
                				</p>
								{{ include("@Content/product/form.html.twig", {"product": product}) }}
                			</div>
                			
                			<footer class="card-footer">
                				<a href="{{ path("product", {'slug': product.getId(), 'category': currentCategory.getId()}) }}" class="btn btn-primary" role="button" title="Voir {{ product.getTitleFr() }}">
                					Détail
                				</a>
                			</footer>
                		</article>
                	</div>
            	{% endfor %}
            </div>
        {% else %}
        	<!-- Boucle sur une sélection de produits des sous-catégories -->
        	{% for childrenProduct in childrenProducts %}
        		<section class="row category-products">
        			<header class="header">
        				<h2>{{ childrenProduct.category.getTitleFr()|upper }}</h2>
        			</header>
        			
        			<!-- Boucle sur les n premiers produits de la sous-categorie courante -->
        			<div class="row">
                    	{% for product in childrenProduct.products|slice(0, 3) if product.getIsEnabled() %}
                    		<div class=" col-xl-3 col-lg-4 col-md-4 col-sm-12 col-xs-12">
                        		<article class="card" id="{{ product.getSlug() }}" data-id="{{ product.getId() }}">
                        			<header class="card-header">
                        				<h3 class="card-title">{{ product.getTitleFr() }}</h3>
                        				{% if product.getSmallestPrice()["multi"] %}
                        					<span class="badge badge-secondary">A partir de {{ product.getSmallestPrice()["ttc"]|number_format(2, ',') }} &euro;</span>
                        				{% else %}
                        					<span class="badge badge-secondary">{{ product.getSmallestPrice()["ttc"]|number_format(2, ',') }} &euro;</span>
                        				{% endif %}
                        			</header>
                        			<figure>
                        				<img class="card-img-top" src="{{ product.getMainImage()["src"] }}" alt="{{ product.getMainImage()["alt"] }}">
                        			</figure>
                        			
                        			<div class="card-body">
                        				<p class="card-text">
                        					{{ product.getDescriptionFr() }}
                        				</p>
                                        {{ include("@Content/product/form.html.twig", {"product": product}) }}
                        			</div>
                        			
                        			<footer class="card-footer">
                        				<a href="{{ path("product", {'slug': product.getId(), 'category': currentCategory.getId()}) }}" class="btn btn-primary" role="button" title="Voir {{ product.getTitleFr() }}">
                        					Détail
                        				</a>
                        			</footer>
                        		</article>
                        	</div>
                    	{% endfor %}        			
        			</div>
        		</section>
        	{% endfor %}
        {% endif %}
    </section>
{% endblock %}